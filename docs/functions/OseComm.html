<link rel="stylesheet" type="text/css" href="../global.css">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1252">
<TITLE>OseComm</TITLE>
</HEAD>

<BODY>
<H1>OseComm</H1>

<TABLE width=100% class=setup>
	<TR class=setup>
		<TD class=item>Availability</TD>
		<TD class=itemdescr>All terminals</TD>
	</TR>
	<TR class=setup>
		<TD class=item>Description</TD>
		<TD class=itemdescr>
			This routine uses the OseComm protocol to transmit and receive one or more complete files through the serial
			communications port that was last opened by <A class=clib HREF="./ComOpen.html">ComOpen()</A>.<BR> The OseComm protocol is
			not susceptible to timing issues, as opposed to the NetO protocol.<BR>
			<BR>
			Features of protocol version 1.01:<BR>
			- Fixed or Auto terminal ID<BR>
			- Set time<BR>
			- Get time<BR>
			- Send file to terminal<BR>
			- Receive file from terminal<BR>
			- Get OS version<BR>
			- Get application version<BR>
			- List files on the terminal<BR>
			- Delete files from the terminal.
		</TD>
	</TR>
	<TR class=setup>
		<TD class=item>Syntax</TD>
		<TD class=itemdescr>
			<SPAN class=c-keyword>long</SPAN> <A class=clib HREF="./OseComm.html">OseComm</A>(<SPAN class=c-keyword>long</SPAN> sessionID, <SPAN class=c-keyword>int</SPAN> terminateKey, <SPAN class=c-keyword>const char</SPAN> *appVersion, pOnOseCommInfo OnOseCommInfo);
			<BR>
		</TD>
	</TR>
	<TR class=setup>
		<TD class=item>Arguments</TD>
		<TD class=itemdescr>
			<H5><SPAN class=c-keyword>long</SPAN> <I>sessionID</I></H5>
			The communication identification number for the session. <BR>
			The valid range is from 0 to 16.777.215 (0x000000 to 0xFFFFFF). <BR>
			If the sessionID supplied is -1, the sessionID will be generated by the device.<BR>

			<H5><SPAN class=c-keyword>int</SPAN> <I>terminateKey</I></H5>
			When this key is pressed the session is aborted.<BR>
			<TABLE class=OPTIONS width=100%>
				<TR>
					<TD>CONNECTION_ABORT</TD>
					<TD>Abort when device is not connected to USB</TD>
				</TR>
				<TR>
					<TD>ANY_KEYS_ABORT</TD>
					<TD>Abort when any key is pressed.</TD>
				</TR>
				<TR>
					<TD>TRIGGER_KEY</TD>
					<TD>Abort when trigger key is pressed.</TD>
				</TR>
				<TR>
					<TD>CLR_KEY</TD>
					<TD>Abort when function key is pressed.</TD>
				</TR>
			</TABLE>

			<H5><SPAN class=c-keyword>const char</SPAN> *<I>appVersion</I></H5>
			A string holding the application version.  When no version string, or an empty version string, is
			used, the terminal will send a command to get the unknown application version.<BR>

			<H5>pOnOseCommInfo <I>OnOseCommInfo</I></H5>
			Callback function that gets the status, error, and progress information. NULL if no callback function is used.<BR>

		</TD>
	</TR>
	<TR class=setup>
		<TD class=item>Returns</TD>
		<TD class=itemdescr>
			OK on success or an error code (negative value) specified as follows:
			<TABLE class=OPTIONS width=100%>
				<TR>
					<TD>0</TD>
					<TD>COMM_OK</TD>
					<TD>Communication OK.</TD>
				</TR>
				<TR>
					<TD>-1</TD>
					<TD>ERR_PR_NO_RESPONSE</TD>
					<TD>No response.</TD>
				</TR>
				<TR>
					<TD>-2</TD>
					<TD>ERR_PR_CRC</TD>
					<TD>CRC-16 error.</TD>
				</TR>
				<TR>
					<TD>-3</TD>
					<TD>ERR_PR_CMD_MISMATCH</TD>
					<TD>Wrong command received.</TD>
				</TR>
				<TR>
					<TD>-4</TD>
					<TD>ERR_HOST_REQ</TD>
					<TD>Host and terminal request did not match.</TD>
				</TR>
				<TR>
					<TD>-5</TD>
					<TD>ERR_PR_SESSION_ID</TD>
					<TD>Session ID mismatch.</TD>
				</TR>
				<TR>
					<TD>-6</TD>
					<TD>ERR_PR_SENDING_FRAME</TD>
					<TD>Error sending frame.</TD>
				</TR>
				<TR>
					<TD>-7</TD>
					<TD>ERR_PR_OPEN_FILE</TD>
					<TD>Cannot open or create the requested file.</TD>
				</TR>
				<TR>
					<TD>-8</TD>
					<TD>ERR_PR_READ_FROM_FILE</TD>
					<TD>Cannot read from file.</TD>
				</TR>
				<TR>
					<TD>-9</TD>
					<TD>ERR_PR_WRITE_TO_FILE</TD>
					<TD>Cannot write to file.</TD>
				</TR>
				<TR>
					<TD>-10</TD>
					<TD>ERR_PR_WRONG_BLOCK</TD>
					<TD>Requested the wrong block number.</TD>
				</TR>
				<TR>
					<TD>-11</TD>
					<TD>ERR_PR_FILE_SIZE</TD>
					<TD>Error in file sizes.</TD>
				</TR>
				<TR>
					<TD>-12</TD>
					<TD>ERR_PR_POLL_COMMAND</TD>
					<TD>Unexpected poll command.</TD>
				</TR>
				<TR>
					<TD>-13</TD>
					<TD>ERR_PR_FILE_UNAVAILABLE</TD>
					<TD>File cannot be found on the terminal.</TD>
				</TR>
				<TR>
					<TD>-14</TD>
					<TD>ERR_PR_LINE_BUSY</TD>
					<TD>Another terminal is already communicating.</TD>
				</TR>
				<TR>
					<TD>-15</TD>
					<TD>ERR_PR_TIME_DATE</TD>
					<TD>Error in the time or date when it is being set.</TD>
				</TR>
				<TR>
					<TD>-20</TD>
					<TD>ERR_PR_USER_ABORT</TD>
					<TD>User aborted the protocol.</TD>
				</TR>
			</TABLE>
		</TD>
	</TR>
	<TR class=setup>
		<TD class=item>Host software</TD>
		<TD class=itemdescr>

			On our <A HREF="https://www.opticon.com/downloads" target="_blank">web site</A> a Windows® application, called OseComm32, can be downloaded which can be used to send and/or receive files from a host device (PC)
			to an Opticon Handheld terminal using the OseComm protocol.<BR>
		</TD>
	</TR>


	<TR class=setup>
		<TD class=item>Example</TD>
		<TD class=itemdescr>
	<PRE>
<SPAN class=c-preprocessor>#include</SPAN> &lt;stdio.h&gt;
<SPAN class=c-preprocessor>#include</SPAN> "lib.h"

<SPAN class=c-keyword>void</span> OnOseComInfo(<SPAN class=c-keyword>int</span> status, <SPAN class=c-keyword>int</span> errorsuccess, <SPAN class=c-keyword>int</span> progress, <SPAN class=c-keyword>const</span> <SPAN class=c-keyword>char</span> *info)
{
    <SPAN class=c-keyword>switch</span> (status)
    {
    <SPAN class=c-keyword>case</span> STAT_GET_TIME_DATE:
        <SPAN class=c-keyword>break</span>;
    <SPAN class=c-keyword>case</span> STAT_SET_TIME_DATE:
        <SPAN class=c-keyword>break</span>;
    <SPAN class=c-keyword>case</span> STAT_GET_OS_VERSION:
        <SPAN class=c-keyword>break</span>;
    <SPAN class=c-keyword>case</span> STAT_GET_APPL_VERSION:
        <SPAN class=c-keyword>break</span>;
    <SPAN class=c-keyword>case</span> STAT_XMIT_FILE_TO_PC:
        <SPAN class=c-comment>//</span><SPAN class=c-comment> if successful then delete the file</span>
        <SPAN class=c-keyword>if</span> (errorsuccess == SUCC_COMPLETE)
            remove(info);    <SPAN class=c-comment>//</span><SPAN class=c-comment> Delete the transfered file</span>
        <SPAN class=c-keyword>break</span>;
    <SPAN class=c-keyword>case</span> STAT_RECV_FILE_FROM_PC:
        <SPAN class=c-keyword>break</span>;
    <SPAN class=c-keyword>case</span> STAT_LIST_FILES:
        <SPAN class=c-keyword>break</span>;
    }
}

<SPAN class=c-keyword>void</span> main(<SPAN class=c-keyword>void</span>)
{
    <SPAN class=c-keyword>for</span> (;;)
    {
        <SPAN class=c-keyword>if</span> (<A class=clib HREF="./IsCharging.html">IsCharging</A>())
        {
            printf(&quot;\nStart OseComm&quot;);
            <SPAN class=c-keyword>if</span> (<A class=clib HREF="./OseComm.html">OseComm</A>( -1L, CONNECTION_ABORT, &quot;OseComm Example&quot;, OnOseComInfo) == COMM_OK)
                printf(&quot;\nOseComm Success&quot;);
            <SPAN class=c-keyword>else</span>
                printf(&quot;\nOseComm aborted&quot;);
        }
        <A class=clib HREF="./Idle.html">Idle</A>();
    }
}
</PRE>
		</TD>
	</TR>
</TABLE>
</BODY>
</HTML>
